<!DOCTYPE html>
<head>
    
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="css/style.css">
   
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript" src="js/scriptDash.js"></script> 
  
</head>
<body>
    <h1>Les compétences des étudiants</h1>
    <div  class="row" id="etu" >
           <div class="col6">
            <h2 id="sltEtu"></h2>
            <p id="mailEtu"></p>
            <p id="technologie"></p>
            </div>
            <div class="col6">
            <img class="img" id="photoEtu" />
               </div> 
      
  
    </div>
  
    <div id='dashboard'></div>

<script>
   var dataEtu, tofEtu=[];
d3.csv("php/lecteurFlux.php?url=THYP1617data", null, function(error, data) {
    freqData = [];
    dataEtu = data;
    /*formulaire THYP*/
                                                                                    
    var comp = {"médiocre":5,"trop fort":10,"mauvais":2,"connais pas":1};
    data.forEach(function(d){
        var args = {
            State:getKeyLine(d)
            ,freq:{
                PHP:comp[d["Vos compétences : langage informatique [PHP]"]], 
                HTML:comp[d["Vos compétences : langage informatique [HTML]"]],
                JSON:comp[d["Vos compétences : langage informatique [jSON]"]],
                CSS:comp[d["Vos compétences : langage informatique [CSS]"]],
                XML:comp[d["Vos compétences : langage informatique [XML]"]],
                JAVA:comp[d["Vos compétences : langage informatique [JAVA]"]],
                SQL:comp[d["Vos compétences : langage informatique [SQL]"]], 
                Python:comp[d["Vos compétences : langage informatique [Phyton]"]],
                ASP:comp[d["Vos compétences : langage informatique [ASP]"]],
                JS:comp[d["Vos compétences : langage informatique [JS]"]],
            }
        };
        d.state = getKeyLine(d);    
        
        //vérification des données
        for(var p in args.freq) {
           if(args.freq[p] == undefined)args.freq[p]=0;
        }       
        freqData.push(args);        
    });
    
    function getKeyLine(d){
        return d["Nom"].substring(0,1).toUpperCase()+""+d["Nom"].substring(2,1)+" "+d["Prénom"].substring(0,1).toUpperCase();
    }

    //récupère les photos
    d3.xml("php/lecteurFlux.php?url=THYP1617photo", "application/xml", function(xml) {
        var tofs = xml.documentElement.getElementsByTagName("group"); 
        for (i = 0; i < tofs.length; i++) { 
            tofEtu[i]={'mini':tofs[i].childNodes[6].getAttribute("url"),'medium':tofs[i].childNodes[5].getAttribute("url"),'large':tofs[i].childNodes[0].getAttribute("url")};
        }
        
        dashboard('#dashboard',freqData);
        
    });
    
});

</script>